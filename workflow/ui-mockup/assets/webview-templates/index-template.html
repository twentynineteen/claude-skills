<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{PLUGIN_NAME}} UI</title>
    <style>
        /* ====================================================================
           CRITICAL CSS CONSTRAINTS
           ==================================================================== */

        /* ⚠️ CRITICAL: Use 100%, NOT 100vh

           Why: JUCE WebView doesn't initialize viewport units (vh, vw, dvh)
           until first resize event. Using them causes blank screen on load.

           ❌ WRONG: body { height: 100vh; }
           ✅ CORRECT: html, body { height: 100%; }
        */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;  /* NOT 100vh - viewport units break first render */
            overflow: hidden;
        }

        /* ====================================================================
           NATIVE APPLICATION FEEL
           ==================================================================== */

        body {
            /* Disable text selection (this is not a document) */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;

            /* Disable touch callouts */
            -webkit-touch-callout: none;

            /* Default cursor (not text cursor) */
            cursor: default;

            /* Disable text highlighting on tap */
            -webkit-tap-highlight-color: transparent;

            /* Plugin styling */
            background: #2a2a2a;
            color: #f0f0f0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                         "Helvetica Neue", Arial, sans-serif;

            /* Layout */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;

            /* Box model consistency */
            box-sizing: border-box;
        }

        *, *::before, *::after {
            box-sizing: border-box;  /* Prevent size calculation surprises */
        }

        /* ====================================================================
           LAYOUT STRUCTURE
           ==================================================================== */

        .plugin-header {
            width: 100%;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #404040;
        }

        .plugin-header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .control-group {
            display: flex;
            gap: 20px;
            padding: 40px 20px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }

        /* ====================================================================
           CONTROL STYLING
           ==================================================================== */

        .control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .control label {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #a0a0a0;
        }

        .control-value {
            font-size: 14px;
            font-weight: 600;
            color: #f0f0f0;
            min-width: 60px;
            text-align: center;
        }

        /* Slider styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 120px;
            height: 6px;
            background: #404040;
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #4a9eff;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.15s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #6bb0ff;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #4a9eff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.15s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            background: #6bb0ff;
        }

        /* Toggle button styling */
        .toggle-button {
            padding: 8px 16px;
            background: #404040;
            border: none;
            border-radius: 4px;
            color: #f0f0f0;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: background 0.15s ease;
        }

        .toggle-button.active {
            background: #4a9eff;
        }

        .toggle-button:hover {
            background: #505050;
        }

        .toggle-button.active:hover {
            background: #6bb0ff;
        }

        /* Dropdown styling */
        select {
            padding: 8px 12px;
            background: #404040;
            border: 1px solid #505050;
            border-radius: 4px;
            color: #f0f0f0;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            outline: none;
        }

        select:hover {
            border-color: #606060;
        }

        select:focus {
            border-color: #4a9eff;
        }
    </style>
</head>
<body>
    <!-- Plugin Header -->
    <div class="plugin-header">
        <h1>{{PLUGIN_NAME}}</h1>
    </div>

    <!-- Control Group -->
    <div class="control-group">
        <!-- {{CONTROL_HTML}} -->
        <!-- Example controls (replace with actual parameters):

        <div class="control">
            <label for="gain-slider">Gain</label>
            <input type="range" id="gain-slider" min="0" max="1" step="0.01" value="0.5">
            <span class="control-value" id="gain-value">50%</span>
        </div>

        <div class="control">
            <label for="tone-slider">Tone</label>
            <input type="range" id="tone-slider" min="0" max="1" step="0.01" value="0.5">
            <span class="control-value" id="tone-value">50%</span>
        </div>

        <div class="control">
            <label for="bypass-toggle">Bypass</label>
            <button class="toggle-button" id="bypass-toggle">Off</button>
        </div>

        <div class="control">
            <label for="mode-select">Mode</label>
            <select id="mode-select">
                <option value="0">Clean</option>
                <option value="1">Warm</option>
                <option value="2">Saturated</option>
            </select>
        </div>

        -->
    </div>

    <!-- JavaScript -->
    <script type="module">
        // ====================================================================
        // JUCE FRONTEND LIBRARY IMPORT
        // ====================================================================

        import * as Juce from "./js/juce/index.js";

        // ====================================================================
        // NATIVE APPLICATION FEEL (JavaScript)
        // ====================================================================

        // Disable right-click context menu
        document.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            return false;
        });

        // Disable default drag behaviors
        document.addEventListener("dragstart", (e) => {
            e.preventDefault();
        });

        // ====================================================================
        // ERROR HANDLING
        // ====================================================================

        // Global error handler
        window.addEventListener("error", (e) => {
            console.error("JavaScript error:", e.message, e.filename, e.lineno);
        });

        // Async error handler
        window.addEventListener("unhandledrejection", (e) => {
            console.error("Unhandled promise rejection:", e.reason);
        });

        // ====================================================================
        // PARAMETER BINDING
        // ====================================================================

        // Verify JUCE backend is connected
        if (!window.__JUCE__) {
            console.error("JUCE backend not available");
            document.body.innerHTML = "<h1>Error: JUCE backend not connected</h1>";
            throw new Error("JUCE backend not connected");
        }

        console.log("JUCE backend connected:", window.__JUCE__.backend);

        // {{PARAMETER_BINDINGS}}
        // Example parameter bindings (replace with actual parameters):

        /*
        // ----------------------------------------------------------------
        // SLIDER PARAMETER BINDING (e.g., Gain)
        // ----------------------------------------------------------------

        // 1. Get state object from C++
        const gainState = Juce.getSliderState("GAIN");  // "GAIN" = parameter ID

        // 2. Get HTML elements
        const gainSlider = document.getElementById("gain-slider");
        const gainValue = document.getElementById("gain-value");

        // 3. Bind HTML → C++ (user interaction)
        gainSlider.addEventListener("input", (e) => {
            const value = parseFloat(e.target.value);
            gainState.setNormalisedValue(value);  // Normalized 0-1

            // Update display
            gainValue.textContent = Math.round(value * 100) + "%";
        });

        // 4. Bind C++ → HTML (automation, preset recall)
        gainState.valueChangedEvent.addListener((newValue) => {
            gainSlider.value = newValue;
            gainValue.textContent = Math.round(newValue * 100) + "%";
        });

        // 5. Initialize from current parameter value
        gainSlider.value = gainState.getNormalisedValue();
        gainValue.textContent = Math.round(gainState.getNormalisedValue() * 100) + "%";

        // ----------------------------------------------------------------
        // TOGGLE BUTTON PARAMETER BINDING (e.g., Bypass)
        // ----------------------------------------------------------------

        // 1. Get state object from C++
        const bypassState = Juce.getToggleButtonState("BYPASS");

        // 2. Get HTML element
        const bypassButton = document.getElementById("bypass-toggle");

        // 3. Bind HTML → C++ (user interaction)
        bypassButton.addEventListener("click", () => {
            const currentState = bypassState.getNormalisedValue();
            const newState = currentState > 0.5 ? 0.0 : 1.0;
            bypassState.setNormalisedValue(newState);

            // Update UI
            bypassButton.textContent = newState > 0.5 ? "On" : "Off";
            bypassButton.classList.toggle("active", newState > 0.5);
        });

        // 4. Bind C++ → HTML (automation, preset recall)
        bypassState.valueChangedEvent.addListener((newValue) => {
            bypassButton.textContent = newValue > 0.5 ? "On" : "Off";
            bypassButton.classList.toggle("active", newValue > 0.5);
        });

        // 5. Initialize from current parameter value
        const bypassValue = bypassState.getNormalisedValue();
        bypassButton.textContent = bypassValue > 0.5 ? "On" : "Off";
        bypassButton.classList.toggle("active", bypassValue > 0.5);

        // ----------------------------------------------------------------
        // DROPDOWN PARAMETER BINDING (e.g., Mode)
        // ----------------------------------------------------------------

        // 1. Get state object from C++
        const modeState = Juce.getComboBoxState("MODE");

        // 2. Get HTML element
        const modeSelect = document.getElementById("mode-select");

        // 3. Bind HTML → C++ (user interaction)
        modeSelect.addEventListener("change", (e) => {
            const index = parseInt(e.target.value);
            const numOptions = modeSelect.options.length;
            const normalizedValue = index / (numOptions - 1);
            modeState.setNormalisedValue(normalizedValue);
        });

        // 4. Bind C++ → HTML (automation, preset recall)
        modeState.valueChangedEvent.addListener((newValue) => {
            const numOptions = modeSelect.options.length;
            const index = Math.round(newValue * (numOptions - 1));
            modeSelect.value = index.toString();
        });

        // 5. Initialize from current parameter value
        const modeValue = modeState.getNormalisedValue();
        const numOptions = modeSelect.options.length;
        const modeIndex = Math.round(modeValue * (numOptions - 1));
        modeSelect.value = modeIndex.toString();
        */

        // ====================================================================
        // REAL-TIME UPDATE LISTENERS (optional)
        // ====================================================================

        // Example: Listen for meter updates from C++ timer
        /*
        window.__JUCE__.backend.addEventListener("meterUpdate", (data) => {
            // Throttle updates to prevent performance issues
            requestAnimationFrame(() => {
                updateMeterDisplay(data.level);
            });
        });

        function updateMeterDisplay(level) {
            // Update meter visualization
            const meterElement = document.getElementById("meter");
            if (meterElement) {
                const heightPercent = Math.max(0, Math.min(100, level * 100));
                meterElement.style.height = heightPercent + "%";
            }
        }
        */

        // Example: Listen for transport updates
        /*
        window.__JUCE__.backend.addEventListener("transportUpdate", (data) => {
            console.log("Transport:", data.isPlaying, data.bpm);
            // Update tempo display, sync animations, etc.
        });
        */

        // ====================================================================
        // INITIALIZATION COMPLETE
        // ====================================================================

        console.log("{{PLUGIN_NAME}} UI initialized");
    </script>
</body>
</html>
