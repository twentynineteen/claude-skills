# Test Preview Generation Protocol

## Overview

Test previews are standalone HTML mockups that demonstrate how the aesthetic would look applied to different plugin types. They use the ui-template-library skill to generate visual representations.

## Step-by-Step Process

### 1. Load Test Plugin Spec

**Spec location:**
```bash
/Users/lexchristopherson/Developer/plugin-freedom-system/.claude/skills/aesthetic-dreaming/assets/test-plugin-specs.json
```

**Read spec for selected plugin type:**

```javascript
const specs = JSON.parse(fs.readFileSync(TEST_SPECS_PATH))
const spec = specs[pluginType] // e.g., "simple-compressor"
```

**Spec structure:**
```json
{
  "id": "simple-compressor",
  "name": "Test Compressor",
  "description": "Classic dynamic range compressor",
  "parameters": [
    {
      "id": "threshold",
      "name": "Threshold",
      "type": "slider",
      "range": { "min": -60, "max": 0, "default": -20 },
      "unit": "dB"
    },
    {
      "id": "ratio",
      "name": "Ratio",
      "type": "knob",
      "range": { "min": 1, "max": 20, "default": 4 },
      "unit": ":1"
    },
    // ... more parameters
  ]
}
```

### 2. Invoke ui-template-library Skill

**Invocation pattern:**

```javascript
Skill("ui-template-library", {
  operation: "apply",
  aesthetic_id: "modern-professional-001",
  target_plugin_name: "TestCompressor",
  parameter_spec: spec,
  output_dir: ".claude/aesthetics/modern-professional-001/test-previews/",
  filename: "simple-compressor.html"
})
```

**Parameters explained:**
- `aesthetic_id`: Unique ID from Phase 3.7 slug generation
- `target_plugin_name`: From spec.name
- `parameter_spec`: Full spec object from test-plugin-specs.json
- `output_dir`: Directory for HTML file (must exist before invocation)
- `filename`: Output filename (plugin-type.html)

### 3. Skill Processing

The ui-template-library skill will:
1. Read aesthetic.md from `.claude/aesthetics/[id]/aesthetic.md`
2. Parse 12 design system sections
3. Apply prose guidance to parameter spec
4. Generate HTML with inline CSS
5. Write standalone HTML file to output_dir

### 4. Verify Output

**Check for:**
- File exists at `.claude/aesthetics/[id]/test-previews/[plugin-type].html`
- File is valid HTML (not empty or error message)
- File can be opened in browser with `open` command

**Example verification:**
```bash
ls -lh .claude/aesthetics/modern-professional-001/test-previews/simple-compressor.html
# Should show file size > 10KB

open .claude/aesthetics/modern-professional-001/test-previews/simple-compressor.html
# Should open in default browser
```

### 5. Error Handling

**If invocation fails:**
1. Log error message with plugin type and aesthetic ID
2. Continue with remaining preview types (don't abort entire Phase 5)
3. Include failure note in Phase 5 confirmation message

**Common errors:**
- Aesthetic.md not found → Check ID and file path
- Invalid parameter spec → Verify test-plugin-specs.json structure
- ui-template-library skill not available → Check skill installation
- Output directory missing → Create directory before invocation

## Test Plugin Types

### simple-compressor
- 4 parameters: Threshold, Ratio, Attack, Release
- Classic dynamics processor layout
- Good for testing: knobs, sliders, meters

### complex-reverb
- 12 parameters: Size, Damping, Mix, Pre-delay, Early reflections, etc.
- Multi-section layout with tabs/groups
- Good for testing: grouping, spacing, visual hierarchy

### drum-machine
- 16 pads + velocity + sequencer controls
- Grid-based layout with interactive elements
- Good for testing: color system, button states, density

### simple-synth
- Oscillators, filters, envelopes, LFOs
- Multi-module layout with routing
- Good for testing: module organization, signal flow visualization

## Integration Notes

- Test previews are optional (user can skip in Phase 4)
- Previews are purely visual (no actual audio processing)
- Each preview is a standalone HTML file (no dependencies)
- Previews can be regenerated by re-running Phase 5

## Prose Generation Principles for Previews

When ui-template-library interprets aesthetic.md for test previews:

1. **Color System** → CSS variables and color palette
2. **Typography** → Font families, sizes, weights
3. **Control Styling** → Knob/slider visual treatment
4. **Spacing** → Padding, margins, grid gaps
5. **Surface Treatment** → Backgrounds, borders, shadows
6. **Details** → Animations, transitions, hover states

The prose should be interpretable, not prescriptive. ui-template-library makes visual choices guided by the prose.
